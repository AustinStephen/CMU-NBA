---
title: "Measuring and Predicting Player Fatigue in the NBA"
author: "<span style='font-size: 40px'>Austin Stephen, Matthew Yep and Grace Fain </style>"
date: "<span style='font-size: 36px'> 7/13/2021 </style>"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    
---
<style type="text/css">

h1.title {
  font-size: 10px;
}

</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

 
```

```{r xaringan-themer, include=FALSE, warning=FALSE }
library(xaringanthemer)
library(teamcolors)
library(usmap)
library(ggplot2)
library(maps)
library(mapdata)
library(dplyr)
library(tidyverse)
library(airball)
library(knitr)
visitors <- read_csv("./matthew_data/visitors.csv")
data1415 <- read_csv("./matthew_data/regseason1415.csv")
datos <- read_csv("./matthew_data/map1415data.csv")
style_mono_accent(base_color = "#cc002c",
  white_color = "#e6e6e6",
  background_color = "#b3b3b3",
  base_font_size = "28px"
  )
```

## Why fatigue?
- Optimized Performance  

- Injury Prevention   

???
Add source that found as players get more tired performance worsens in basketball.
Add source that talks about injury links to fatigue 
Add a source that 

---

## The Plan

1. Measure player fatigue  
  
2. Build a model that can be used to predict the impact of fatigue on a given game or
multi-game sequence.


???
Identify a proxy for fatigue and link it to in game performance.
This model can used by teams to examine their roster and match-ups and gain insights into 
how differnt factors are influencing their teams performance

---

## Measuring player fatigue
- Cannot use direct measures
  
- Identify a proxy

???
NBA players cannot wear heart rate monitors or tracking equipment in games 

---

## Proxy for Fatigue
- In game distance
- Between game distance

???
We are examining two major sources for player fatigue.
1. The distance and speed at which they travel in game. 
2. The characteristics of their travel between games including days of rest,
distance traveled and time zone changes.

---

## The in-game data

???
Insert table showing how it is structured

---

## Progress with in-game data

???
Go through progress with in game data

---

## Progress with in-game data 2

???
Go through progress with in game data

---
# GRACE ADD HERE 

Grace add your progress with in-game data

---

### How does travel between games affect team performance?
```{r Map, echo = FALSE, fig.height= 6.5, fig.width=12}
cumulative_distance1415 <- data1415 %>%
  group_by(Team) %>%
  summarise_at(vars(Distance),
               list(total_distance_traveled = sum))

home_stadium_coords <- data1415 %>%
  filter(Visitor == FALSE) %>%
  select(Team, Latitude, Longitude) %>%
  distinct()

coords_and_distance <- merge(x = cumulative_distance1415,  y= home_stadium_coords,
                             by = "Team")

highlight <- coords_and_distance %>%
  filter(Team %in% c("Portland Trail Blazers","Denver Nuggets", 
                     "Cleveland Cavaliers", "Boston Celtics"))

usa <- map_data("usa")
states <- map_data("state")
ggplot() + geom_polygon(data = states, aes(x=long, y = lat, fill = region, group = group), fill = "azure2", color = "gray") + 
  coord_fixed(1.3) +
  geom_point(data = coords_and_distance, aes(x=Longitude, y=Latitude,  
                                             size = sqrt(total_distance_traveled)),
             alpha = 0.8) + 
  theme(axis.line=element_blank(),axis.text.x=element_blank(),
        axis.text.y=element_blank(),axis.ticks=element_blank(),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        panel.background=element_blank(),panel.border=element_blank(),panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),plot.background=element_blank(),
        legend.position = "top") +
  geom_point(data = highlight, aes(x=Longitude, y=Latitude,colour = "red", size = sqrt(total_distance_traveled))) +
  geom_text(data = coords_and_distance, aes(x=Longitude, y=Latitude, 
                                            label=ifelse(Team %in% c("Portland Trail Blazers","Denver Nuggets", 
                                         "Cleveland Cavaliers", "Boston Celtics"),
                             as.character(Team),'')), hjust= 0,vjust=0)
```

---

### The Cavaliers also cross far less timezones than the coastal teams
```{r Flight Paths, echo = FALSE, fig.height = 7, fig.width=12}
nba_travel_plot(data = datos,
                season = 2015,
                team = c("Portland Trail Blazers","Denver Nuggets", "Cleveland Cavaliers", "Boston Celtics"),
                city_color = "yellow",
                plot_background_fill = "black",
                land_color = "gray",
                caption_color = "lightblue",
                ncolumns = 2)
```

---

### Travel, Schedule and Density Data

```{r Matthew data, echo=FALSE, fig.align = "center", fig.height = 16,fig.width = 40}
library(png) 
library(grid) 
img <- readPNG("./images/example_data.png") 
grid.raster(img)
```
- **Granularity:** Each row represents a game. The stats are relative to the visiting team in the *Team* column
---

### Linear Model: Distance doesn't have a significant effect on the score diff
score_diff = $\beta_0$ + $\beta_1$ win_percent_diff + $\beta_2$distance + $\beta_3$rest + 
$\beta_4$shift + $\beta_5$b2b_2nd + $\beta_6$three_in_four

```{r Linear Model, echo=FALSE, fig.align = "center", fig.height = 4.5, fig.width = 6}
img2 <- readPNG("./images/summary_visitors_model.png") 
grid.raster(img2)
```


---

#What's on deck
- Find stronger proxies to account for difference in team vs opponent strength
- Logistic regression model predicting win or loss instead of score difference
- Test the models on Bubble and 2021 data (where there was none of significantly less travel/shift between timezones)

