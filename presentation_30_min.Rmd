---
title: "<span style='font-size: 70px'>Modeling Player Fatigue in the NBA </style>"
author: "<span style='font-size: 35px'>Austin Stephen, Matthew Yep and Grace Fain </style>"
date: "<span style='font-size: 35px'> 7/30/2021 </style>"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
---


```{r  xaringan-themer, setup, include=FALSE}
library(xaringanthemer)
knitr::opts_chunk$set(
  echo = FALSE,
  cache = FALSE,
  message = FALSE,
  warning = FALSE
  )
library(readr)
library(dplyr)
library(tidyverse)
library(gt)
library(xaringanthemer)
library(teamcolors)
library(usmap)
library(ggplot2)
library(maps)
library(mapdata)
library(airball)
library(gridExtra)
library(png)
library(grid)
```

```{r xaringan-themer, include=FALSE, warning=FALSE }

visitors <- read_csv("./matthew_data/visitors.csv")
data1415 <- read_csv("./matthew_data/regseason1415.csv")
datos <- read_csv("./matthew_data/map1415data.csv")

style_mono_accent(base_color = "#cc002c",
  white_color = "#e6e6e6",
  background_color = "#b3b3b3",
  base_font_size = "28px"
  )
```

## Why Fatigue?  

<span> 1.</span> Player Performance

???
The literature is very clear that insufficient rest worsens althlete preformance. 

"Early identification and subsequent management of fatigue may prevent detrimental 
physical and physiological adaptations often associated with injury and enhance 
athletic performance and player availability"
Edwards et al The National Center for Biotechnology Information

--

<span> 2. </span> Schedule Fairness  

--


INSERT GAPHIC AND DISTANCE TRAVELED B2B DISCUSSION

---

## Findings  

1. In-game distance measures currently lack the granularity to study player fatigue 

--

2. A subset of schedule induced factors impact game outcomes 

--

3. Impact of travel has decreased over time 

  

???
1. In-game distance measures lack the granularity to measure player fatigue.

2. Only a few schedule induced factors have a measurable impact on game outcomes

3. This could be due to 

---

## What is Fatigue?

- Cannot use direct measures  

--

- Identify events that fatigue players
--

  - Ex. Distance run, timezone change, etc.

???
You cannot identify a proxy for something you don't understand.

More concrete on fatigue: 
"the decline in objective performance measures derived from the capacity 
of the nervous system and contractile properties of muscles over time"
Edwards et al. The National Center for Biotechnology Information

In a perfect world we would directly measure an NBA players internal homeostasis
either with hematological techniques or with sensors that measure heart rate. 
However, players cannot wear heart rate monitors or tracking equipment in 
games and we certainly don't have data about in/post-game blood samples 
so we need a proxy to measure how fatigued a player was by in game events.


---

## Sources of Fatigue

1. In-game events  

2. Between game events

???
2 major sources for measuring volume of strain that could induce player fatigue.


---

## In-Game Distance  

```{r}
 tracking_player <- read_csv(
   "data/in_game_distance_data/tracking_by_player_season_daily_2018_19.csv")


 tracking_player %>%
   select(c("player_name","date","min", "dist_miles","dist_miles_off", "dist_miles_def",
            "avg_speed","avg_speed_off","avg_speed_def")) %>%
   rename("Name" = player_name,
          "Distance (mi)" = dist_miles,
          "Distance Offense"  = dist_miles_off,
          "Distance Defense" = dist_miles_def,
          "Speed (mph)" = avg_speed,
          "Speed Offense" = avg_speed_off,
          "Speed Defense" = avg_speed_def,
          "Date" = date,
          "Min" = min) %>%
   slice(1:4) %>%
   gt() %>%
   tab_header(
    title = md("**Distance By Player Individual Games**")
  ) %>%
  tab_source_note(md("Data courtesy of nba.com and Second Spectrum")) %>%
  opt_table_outline( style = "solid", width = px(5), color = "#666666")%>%
  tab_options(table.width = pct(80))
```

???
3 important things
Gen by computer vision  
Game by game  
Player level  

---

## In-Game Distance 

- How does player distance relate to game outcomes

AUSTIN ADD YOUR STUFF
```{r}

```

---

## In-game Distance 

- How does player distance relate to game outcomes
AUSTIN ADD YOUR STUFF
```{r}

```


---

## In-Game Distance 

- How does player distance relate to game outcomes
AUSTIN ADD YOUR STUFF

```{r}

```

---

---

## In-Game Distance 

- How does player distance relate to game outcomes
GRACE ADD your stuff

---

## In-Game Distance 

- How does player distance relate to game outcomes
GRACE ADD your stuff

---

## Between Game Events 
 MATTHEW INTRODUCE DATA

???
Transition by saying in game events are only half the picture.

---

## Between Game Events 

GRACE T-TEST HERE
```{r t-test, echo = false}

together_final <- read.csv("./data1/together_final.csv")

team_b2b_vis <- together_final %>%
  filter(b2b_2nd == TRUE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_other_vis <- together_final %>%
  filter(b2b_2nd == FALSE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_b2b_vis <- together_final %>%
  filter(b2b_2nd == TRUE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_other_vis <- together_final %>%
  filter(b2b_2nd == FALSE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_3in4_vis <- together_final %>%
  filter(three_in_four == TRUE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_other3in4_vis <- together_final %>%
  filter(three_in_four == FALSE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_b2b_3in4_vis <- together_final %>%
  filter(b2b_2nd == TRUE) %>%
  filter(three_in_four == TRUE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_otherb2b_3in4_vis <- together_final %>%
  filter(b2b_2nd == FALSE) %>%
  filter(three_in_four == FALSE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_b2b_3in4_home <- together_final %>%
  filter(b2b_2nd_home == TRUE) %>%
  filter(three_in_four_home == TRUE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_otherb2b_3in4_home <- together_final %>%
  filter(b2b_2nd_home == FALSE) %>%
  filter(three_in_four_home == FALSE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_3hoursforward_vis <- together_final %>%
  filter(travel_3_hours_forward == TRUE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_other_3hoursforward_vis <- together_final %>%
  filter(travel_3_hours_forward == FALSE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_3hoursback_vis <- together_final %>%
  filter(travel_3_hours_back == TRUE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

team_other_3hoursback_vis <- together_final %>%
  filter(travel_3_hours_back == FALSE) %>%
  mutate(Win = ifelse(Win == TRUE, 1, 0))

t_b2b<- t.test(team_otherb2b_vis$Win, team_b2b_vis$Win)

t_3in4 <-t.test(team_other3in4_vis$Win, team_3in4_vis$Win)

t_b2b_3in4 <- t.test(team_otherb2b_3in4_vis$Win, team_b2b_3in4_vis$Win)

t_3hrsForward <- t.test(team_other_3hoursforward_vis$Win, team_3hoursforward_vis$Win)

t_3hrsBack <- t.test(team_other_3hoursback_vis$Win, team_3hoursback_vis$Win)

t_3hrsForward_NetRatingDiff <- t.test(team_other_3hoursforward_vis$net_rating_diff, team_3hoursforward_vis$net_rating_diff)

t_3hrsBack_NetRatingDiff <- t.test(team_other_3hoursback_vis$net_rating_diff, team_3hoursback_vis$net_rating_diff)


team_t_test_info <- tibble(Test = c("B2B_Win", "Three_in_Four_Win", 
                "b2b_and_3in4_Win", "3hrsForward_Win", 
                "3hrsBack_Win", "3hrsForward_NRD",
                "3hrsBack_NRD"), 
       "Mean_of_X" = c(t_b2b$estimate[1], t_3in4$estimate[1],
                       t_b2b_3in4$estimate[1], t_3hrsForward$estimate[1],
                       t_3hrsBack$estimate[1], t_3hrsForward_NetRatingDiff$estimate[1],
                       t_3hrsBack_NetRatingDiff$estimate[1]),
       "Mean_of_Y" = c(t_b2b$estimate[2], t_3in4$estimate[2],
                       t_b2b_3in4$estimate[2], t_3hrsForward$estimate[2],
                       t_3hrsBack$estimate[2], t_3hrsForward_NetRatingDiff$estimate[2],
                       t_3hrsBack_NetRatingDiff$estimate[2]),
       "P_Value" = c(t_b2b$p.value, t_3in4$p.value, t_b2b_3in4$p.value,
                     t_3hrsForward$p.value, t_3hrsBack$p.value,
                     t_3hrsForward_NetRatingDiff$p.value, t_3hrsBack_NetRatingDiff$p.value))


```

---

## Between Game Events

AUSTIN INTRODUCE THE NEED TO CONTROL FOR TEAM STRENGTH 

---

## Modeling for Team Strength

AUSTIN INTRODUCE 2 CONCEPTS FOR MODELS AND WHY WE FOCUSED ON TYPE 2

---

## Modeling Team Strength 

AUSTIN EXPLAIN OUR MODEL

---

## Modeling Team Strength 

AUSTIN SHOW OUR MODELS IMPORVED RESULTS

---
## Mesuring the Impact of Between Game Events 

MATTHEW SHOW OUR COEFFCICENTS 

---
## Mesuring the Impact of Between Game Events 

MATTHEW SHOW OUR COEFFCICENTS OVER THE SEASONS

---
## Flexible Modeling Techniques 

GRACE TALK about the modeling techniques we tried

--
## Flexible Modeling Techniques 

GRACE TALK about the modeling techniques we tried

--
How Can Teams Use This Information?

--
Future Work




